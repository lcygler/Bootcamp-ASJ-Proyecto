<div class="container m-4" style="width: 100vw">
  <!-- Breadcrumbs -->
  <div class="row">
    <nav aria-label="breadcrumb">
      <ol class="breadcrumb">
        <li class="breadcrumb-item"><a routerLink="/home">Inicio</a></li>
        <li
          class="breadcrumb-item active"
          aria-current="page"
          *ngIf="!isCategoryEdit && !isIndustryEdit"
        >
          Gestión
        </li>
        <li class="breadcrumb-item" *ngIf="isCategoryEdit || isIndustryEdit">
          <a routerLink="/management">Gestión</a>
        </li>
        <li
          class="breadcrumb-item active"
          aria-current="page"
          *ngIf="isCategoryEdit || isIndustryEdit"
        >
          {{ breadcrumb }}
        </li>
      </ol>
    </nav>
  </div>

  <div class="container mt-3" style="width: 75vw">
    <div class="row d-flex">
      <!-- Categorías -->
      <div class="col-md-6" style="padding-right: 50px">
        <!-- Title -->
        <div class="row">
          <h2 class="mb-4">Categorías</h2>
        </div>

        <!-- Form -->
        <div class="row mb-2">
          <form
            #CategoryForm="ngForm"
            (ngSubmit)="onCategorySubmit(CategoryForm)"
          >
            <div class="row">
              <fieldset>
                <!-- Nombre -->
                <div class="col-md">
                  <div class="mb-3">
                    <label for="category-name" class="form-label">
                      {{
                        isCategoryEdit
                          ? "Editar categoría:"
                          : "Agregar categoría:"
                      }}
                    </label>
                    <div class="d-flex align-items-center">
                      <input
                        type="text"
                        class="form-control"
                        id="category-name"
                        name="categoryName"
                        placeholder="Ingrese una categoría"
                        [ngClass]="{
                        'is-invalid': categoryName.touched && (categoryName.errors || !isCategoryValid()),
                        'is-valid': categoryName.touched && !categoryName.errors && category.name,
                      }"
                        [(ngModel)]="category.name"
                        #categoryName="ngModel"
                        minlength="4"
                        maxlength="255"
                      />
                      <!-- Cancelar -->
                      <button
                        type="button"
                        class="btn btn-outline-secondary ms-2 d-flex align-items-center justify-content-center"
                        (click)="navigateToManagement()"
                        *ngIf="isCategoryEdit"
                      >
                        <span>Cancelar</span>
                      </button>
                      <!-- Agregar/Guardar -->
                      <button
                        type="submit"
                        class="btn btn-success ms-2 d-flex align-items-center justify-content-center"
                        [disabled]="
                          !category.name ||
                          !isCategoryValid() ||
                          categoryName.errors
                        "
                      >
                        <span>{{
                          isCategoryEdit ? "Guardar" : "Agregar"
                        }}</span>
                      </button>
                    </div>
                    <div
                      *ngIf="categoryName.touched && !isCategoryValid()"
                      class="col-auto"
                    >
                      <span class="form-text text-danger"
                        >La categoría ya está en uso</span
                      >
                    </div>
                    <div
                      *ngIf="categoryName.touched && categoryName.errors?.['minlength']"
                      class="col-auto"
                    >
                      <span class="form-text text-danger"
                        >La categoría debe tener al menos 4 caracteres</span
                      >
                    </div>
                    <div
                      *ngIf="categoryName.touched && categoryName.errors?.['maxlength']"
                      class="col-auto"
                    >
                      <span class="form-text text-danger"
                        >La categoría no debe superar los 50 caracteres</span
                      >
                    </div>
                  </div>
                </div>
              </fieldset>
            </div>
          </form>
        </div>

        <!-- Tabla -->
        <div class="row">
          <table
            class="table table-bordered table-hover text-center align-middle"
          >
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Estado</th>
                <th>
                  <div class="d-flex justify-content-center align-items-center">
                    <span class="material-icons-outlined"> more_horiz </span>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let category of categoryList">
                <td>{{ category.id }}</td>
                <td>{{ category.name }}</td>
                <td>{{ category.isDeleted ? "Inactivo" : "Activo" }}</td>
                <td>
                  <!-- Actions -->
                  <div class="btn-group">
                    <!-- Editar -->
                    <button
                      class="btn btn-outline-secondary custom-dark"
                      (click)="editCategory(category.id!)"
                      *ngIf="!category.isDeleted"
                    >
                      <span class="material-icons" style="font-size: 16px"
                        >edit</span
                      >
                    </button>

                    <!-- Borrar -->
                    <button
                      type="button"
                      class="btn btn-outline-danger"
                      (click)="
                        confirmDeleteCategory(category.id!, category.name)
                      "
                      data-bs-toggle="modal"
                      data-bs-target="#deleteCategoryModal"
                      *ngIf="!category.isDeleted"
                    >
                      <span class="material-icons" style="font-size: 16px">
                        delete
                      </span>
                    </button>

                    <!-- Restaurar -->
                    <button
                      type="button"
                      class="btn btn-outline-success"
                      (click)="
                        confirmRestoreCategory(category.id!, category.name)
                      "
                      data-bs-toggle="modal"
                      data-bs-target="#restoreCategoryModal"
                      *ngIf="category.isDeleted"
                    >
                      <span class="material-icons" style="font-size: 16px">
                        undo
                      </span>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>

      <!-- Rubros -->
      <div class="col-md-6">
        <!-- Title -->
        <div class="row">
          <h2 class="mb-4">Rubros</h2>
        </div>

        <!-- Form -->
        <div class="row mb-2">
          <form
            #IndustryForm="ngForm"
            (ngSubmit)="onIndustrySubmit(IndustryForm)"
          >
            <div class="row">
              <fieldset>
                <!-- Nombre -->
                <div class="col-md">
                  <div class="mb-3">
                    <label for="industry-name" class="form-label">
                      {{ isIndustryEdit ? "Editar rubro:" : "Agregar rubro:" }}
                    </label>
                    <div class="d-flex align-items-center">
                      <input
                        type="text"
                        class="form-control"
                        id="industry-name"
                        name="industryName"
                        placeholder="Ingrese un rubro"
                        [ngClass]="{
                        'is-invalid': industryName.touched && (industryName.errors || !isIndustryValid()),
                        'is-valid': industryName.touched && !industryName.errors && industry.name,
                      }"
                        [(ngModel)]="industry.name"
                        #industryName="ngModel"
                        minlength="4"
                        maxlength="255"
                      />
                      <!-- Cancelar -->
                      <button
                        type="button"
                        class="btn btn-outline-secondary ms-2 d-flex align-items-center justify-content-center"
                        (click)="navigateToManagement()"
                        *ngIf="isIndustryEdit"
                      >
                        <span>Cancelar</span>
                      </button>
                      <!-- Agregar/Guardar -->
                      <button
                        type="submit"
                        class="btn btn-success ms-2 d-flex align-items-center justify-content-center"
                        [disabled]="
                          !industry.name ||
                          !isIndustryValid() ||
                          industryName.errors
                        "
                      >
                        <span>{{
                          isIndustryEdit ? "Guardar" : "Agregar"
                        }}</span>
                      </button>
                    </div>
                    <div
                      *ngIf="industryName.touched && !isIndustryValid()"
                      class="col-auto"
                    >
                      <span class="form-text text-danger"
                        >El rubro ya está en uso</span
                      >
                    </div>
                    <div
                      *ngIf="industryName.touched && industryName.errors?.['minlength']"
                      class="col-auto"
                    >
                      <span class="form-text text-danger"
                        >El rubro debe tener al menos 4 caracteres</span
                      >
                    </div>
                    <div
                      *ngIf="industryName.touched && industryName.errors?.['maxlength']"
                      class="col-auto"
                    >
                      <span class="form-text text-danger"
                        >El rubro no debe superar los 50 caracteres</span
                      >
                    </div>
                  </div>
                </div>
              </fieldset>
            </div>
          </form>
        </div>

        <!-- Tabla -->
        <div class="row">
          <table
            class="table table-bordered table-hover text-center align-middle"
          >
            <thead class="table-light">
              <tr>
                <th>ID</th>
                <th>Nombre</th>
                <th>Estado</th>
                <th>
                  <div class="d-flex justify-content-center align-items-center">
                    <span class="material-icons-outlined"> more_horiz </span>
                  </div>
                </th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let industry of industryList">
                <td>{{ industry.id }}</td>
                <td>{{ industry.name }}</td>
                <td>{{ industry.isDeleted ? "Inactivo" : "Activo" }}</td>
                <td>
                  <!-- Actions -->
                  <div class="btn-group">
                    <!-- Editar -->
                    <button
                      class="btn btn-outline-secondary custom-dark"
                      (click)="editIndustry(industry.id!)"
                      *ngIf="!industry.isDeleted"
                    >
                      <span class="material-icons" style="font-size: 16px"
                        >edit</span
                      >
                    </button>

                    <!-- Borrar -->
                    <button
                      type="button"
                      class="btn btn-outline-danger"
                      (click)="
                        confirmDeleteIndustry(industry.id!, industry.name)
                      "
                      data-bs-toggle="modal"
                      data-bs-target="#deleteIndustryModal"
                      *ngIf="!industry.isDeleted"
                    >
                      <span class="material-icons" style="font-size: 16px">
                        delete
                      </span>
                    </button>

                    <!-- Restaurar -->
                    <button
                      type="button"
                      class="btn btn-outline-success"
                      (click)="
                        confirmRestoreIndustry(industry.id!, industry.name)
                      "
                      data-bs-toggle="modal"
                      data-bs-target="#restoreIndustryModal"
                      *ngIf="industry.isDeleted"
                    >
                      <span class="material-icons" style="font-size: 16px">
                        undo
                      </span>
                    </button>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- Acciones -->
    <div class="row mt-3">
      <div class="d-flex justify-content-center">
        <button
          type="button"
          class="btn btn-outline-secondary"
          (click)="navigateBack()"
        >
          Volver
        </button>
      </div>
    </div>
  </div>

  <!-- Delete Category Modal -->
  <div
    class="modal fade"
    id="deleteCategoryModal"
    tabindex="-1"
    aria-labelledby="deleteCategoryModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="deleteCategoryModalLabel">
            Eliminar Categoría
          </h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body" [innerHTML]="deleteMessage"></div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline-secondary"
            data-bs-dismiss="modal"
          >
            Cancelar
          </button>
          <button
            type="button"
            class="btn btn-danger"
            data-bs-dismiss="modal"
            (click)="deleteCategory()"
          >
            Eliminar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Delete Industry Modal -->
  <div
    class="modal fade"
    id="deleteIndustryModal"
    tabindex="-1"
    aria-labelledby="deleteIndustryModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="deleteIndustryModalLabel">
            Eliminar Rubro
          </h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body" [innerHTML]="deleteMessage"></div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline-secondary"
            data-bs-dismiss="modal"
          >
            Cancelar
          </button>
          <button
            type="button"
            class="btn btn-danger"
            data-bs-dismiss="modal"
            (click)="deleteIndustry()"
          >
            Eliminar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Restore Category Modal -->
  <div
    class="modal fade"
    id="restoreCategoryModal"
    tabindex="-1"
    aria-labelledby="restoreCategoryModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="restoreCategoryModalLabel">
            Restaurar Categoría
          </h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body" [innerHTML]="restoreMessage"></div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline-secondary"
            data-bs-dismiss="modal"
          >
            Cancelar
          </button>
          <button
            type="button"
            class="btn btn-success"
            data-bs-dismiss="modal"
            (click)="restoreCategory()"
          >
            Restaurar
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Restore Industry Modal -->
  <div
    class="modal fade"
    id="restoreIndustryModal"
    tabindex="-1"
    aria-labelledby="restoreIndustryModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h1 class="modal-title fs-5" id="restoreIndustryModalLabel">
            Restaurar Rubro
          </h1>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Close"
          ></button>
        </div>
        <div class="modal-body" [innerHTML]="restoreMessage"></div>
        <div class="modal-footer">
          <button
            type="button"
            class="btn btn-outline-secondary"
            data-bs-dismiss="modal"
          >
            Cancelar
          </button>
          <button
            type="button"
            class="btn btn-success"
            data-bs-dismiss="modal"
            (click)="restoreIndustry()"
          >
            Restaurar
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
